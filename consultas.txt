set search_path = cines;

-- a) Devolver actores que solo figuran en una sola película.
SELECT persona.dni, persona.nombre
FROM persona
INNER JOIN protagonizo ON persona.dni = protagonizo.dni
GROUP BY persona.dni, persona.nombre
HAVING COUNT(protagonizo.id_pelicula) = 1;

-- b) Listar las personas que han sido actores y directores.
SELECT DISTINCT dni AS actuo_y_dirigio 
FROM (SELECT dni FROM protagonizo UNION SELECT dni FROM reparto) AS actores 
INNER JOIN dirige USING (dni);

-- c) Listar los cines con la cantidad total de butacas totales.
SELECT nombre_cine, sum(cant_butaca) AS cant_butaca_totales 
FROM sala 
GROUP BY nombre_cine;

-- d) Definir consultas propias (no menos de tres), donde por lo menos una utilice subconsultas.

-- 1) Listar las personas que actuaron en mas de dos peliculas
SELECT DISTINCT actuaron.dni AS actuo_2_o_mas 
FROM (SELECT * FROM protagonizo  UNION SELECT * FROM reparto) AS actuaron, 
(SELECT * FROM protagonizo UNION SELECT * FROM reparto) AS actuaron2 
WHERE (actuaron.dni = actuaron2.dni AND actuaron.id_pelicula != actuaron2.id_pelicula);

-- 2) Mostrar la pelicula (id_pelicula, titulo_espanol) mas larga 
SELECT p.id_pelicula, p.titulo_espanol 
FROM pelicula p 
INNER JOIN ( SELECT  MAX (duracion) AS max_du FROM pelicula ) AS max_duracion 
ON p.duracion = max_duracion.max_du; 

-- 3) Actores que hayan protagonizado películas de terror 
SELECT DISTINCT persona.dni, persona.nombre
FROM persona
INNER JOIN protagonizo ON persona.dni = protagonizo.dni 
INNER JOIN pelicula ON protagonizo.id_pelicula = pelicula.id_pelicula
WHERE pelicula.genero = "suspenso";

-- 4) Películas cuya duración sea mayor que el promedio de duración de todas las películas:

SELECT pelicula.titulo_original, pelicula.titulo_espanol, pelicula.titulo_distrib, pelicula.duracion AS promedio
FROM pelicula
WHERE pelicula.duracion > (
	SELECT AVG(duracion)
	FROM pelicula
);
